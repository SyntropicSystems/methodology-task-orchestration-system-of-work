# Context: Monorepo skeleton & DX bootstrap

## Background

This is the foundational task for setting up the v0 monorepo structure. The system needs bounded contexts with clear dependency rules, schema-driven development with code generation, and developer experience tooling that doesn't slow down the v0 build loop.

## Key Information

### Repo Structure Mapping

```
wishflower-v0/
  platform/                  # type: platform
    schemas/                 # Protobuf + OpenAPI sources (single truth)
    obs-core/                # cross-lang observability helpers
  libraries/                 # type: library
    rs-protos/               # generated prost/tonic code
    py-protos/               # generated betterproto
    ts-client/               # generated OpenAPI TS client
    obs-rs/                  # Rust tracing helpers
    obs-py/                  # Python tracing helpers
  products/                  # type: product (leaf, runnable)
    ui-web/                  # Next.js
    gateway-rust/            # Rust Axum API gateway
    ai-gateway-py/           # FastAPI stub
    orchestrator-py/         # Temporal worker + bridge
    analytics-consumer-py/
    archive-writer-py/
  data/                      # type: data (files only)
    db/migrations/
    db/seed/
    infra/otel/collector.yaml
    infra/grafana-provisioning/
  tooling/                   # type: tooling
    boundary_checker/
    schema_codegen/
  tests/
```

### Boundary Rules

**Rule**: products never depend on products. Everyone depends on platform/schemas and libraries/ as needed. data/ is only consumed as files.

### Component Type Matrix

- **platform**: can be depended on by [library, product, tooling, test]
- **library**: can depend on [platform, library]; can be depended on by [library, product, tooling, test]
- **product**: can depend on [platform, library, data]; can be depended on by [test]
- **tooling**: can depend on [platform, library, data]; can be depended on by [test]
- **data**: read-only files, no code dependencies
- **test**: can depend on anything

### Files to Create

1. `.bazelversion` - Bazel version pin
2. `.bazelrc` - Build configuration with boundary checking
3. `WORKSPACE.bazel` - Workspace definition
4. `.workspace/component_types.bzl` - Type definitions
5. `.workspace/boundary_rules.bzl` - Enforcement aspect
6. `BUILD.bazel` files - Per component
7. `Makefile` - Workspace commands
8. `tooling/schema_codegen/run.sh` - Code generation script
9. `COMPONENT.yaml` - Per component metadata
10. `LLM-CONTEXT.md` - Per component AI context

### Key Principles

- Keep Bazel scope bounded: validation and contracts only, not builds
- Commit generated code in v0 for speed
- Default visibility to private, explicit allowlists
- Use Make for developer commands
- Docker Compose for container orchestration (not Bazel)

## References

- Original task specification in C00-Mono-repo-setup.task.md
- Bazel documentation: https://bazel.build
- Buf documentation: https://buf.build
- OpenAPI Generator: https://openapi-generator.tech
